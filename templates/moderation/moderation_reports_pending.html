{% extends "moderation/moderation_panel.html" %}

{% set active_tab = "pending" %}

{% block moderation_content %}
<div class="moderation-content">
    <div class="tab-header">
        <h4>待处理举报</h4>
        <div class="tab-actions">
            <div class="search-box">
                <input type="text" placeholder="搜索举报..." id="reportSearch">
                <i class="fas fa-search"></i>
            </div>
        </div>
    </div>
    
    {% if pending_reports %}
        <div class="report-list">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>举报ID</th>
                        <th>举报人</th>
                        <th>被举报人</th>
                        <th>举报类别</th>
                        <th>举报内容</th>
                        <th>举报原因</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody>
                    {% for report in pending_reports %}
                    <tr>
                        <td>{{ report.id }}</td>
                        <td>{{ report.reporter.username }}</td>
                        <td>{{ report.offender.username }}</td>
                        <td>{{ report.category }}</td>
                        <td>
                            {% if report.category == 'post' %}
                                <a href="{{ url_for('view_post', post_id=report.post_id) }}" class="report-link">
                                    <i class="fas fa-link"></i> 查看帖子
                                </a>
                            {% else %}
                                <a href="{{ url_for('view_comment', comment_id=report.comment_id) }}" class="report-link">
                                    <i class="fas fa-link"></i> 查看评论
                                </a>
                            {% endif %}
                        </td>
                        <td>{{ report.reason }}</td>
                        <td>
                            <button class="btn btn-danger btn-sm" onclick="handleReport({{ report.id }}, 'invalid')">
                                <i class="fas fa-check"></i> 已违规
                            </button>
                            <button class="btn btn-success btn-sm" onclick="handleReport({{ report.id }}, 'valid')">
                                <i class="fas fa-times"></i> 未违规
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- 分页控件 -->
        <div class="pagination">
            {% if pagination.has_prev %}
            <a href="{{ url_for('moderation_reports_pending', page=pagination.prev_num) }}" class="page-link">
                <i class="fas fa-chevron-left"></i> 上一页
            </a>
            {% endif %}

            <span class="page-info">{{ pagination.page }} / {{ pagination.pages }}</span>

            {% if pagination.has_next %}
            <a href="{{ url_for('moderation_reports_pending', page=pagination.next_num) }}" class="page-link">
                下一页 <i class="fas fa-chevron-right"></i>
            </a>
            {% endif %}
        </div>
    {% else %}
        <div class="alert alert-info text-center">
            <i class="fas fa-info-circle"></i> 暂无待处理举报
        </div>
    {% endif %}
</div>

<link rel="stylesheet" href="{{ url_for('static', filename='css/section_detail.css') }}">
<script type="module" src="{{ url_for('static', filename='js/csrf.js') }}"></script>
<script type="module" src="{{ url_for('static', filename='js/report.js') }}"></script>
{% endblock %}